# Direct Calculation Method of Fluctuations

This code is the code that I have developed to calculate derivatives of correlation functions from LAMMPS and CP2K Molecular Dynamics simulations. So far - the code has support for msd, c2, shear viscosity, and the flux side correlation functions. Adding new correlation functions is relatively simple (just need to add them using fortran and call them in the submission script).

## How to Use the Program

Type the following in the Direct Calculation Fluctuations code.
```
bash backbone.sh
``` 

### Prerequisites
Currently: python 2.7 with scipy and numpy support, as well as the bash shell.
           Furthermore - this program assumes that you are running on a cluster environment with access to the Torque Q-engine

## Code Components

I will give a rundown of code components

### backbone.sh

This is the key backbone of the entire automation script. It functions by checking the completed tasks, and then performing the next task in the series of tasks. This means that you will primarily inteface with this software by rerunning the backbone.sh script repeatedly until it tells you to stop. 

The key backbone steps:

1) Instructions Step (.flag_instruct)
    -Tells you to create input_file and flucts.inp
    -Lets you choose to create input_file through gen_input.py if you want. 
2) Compilation Step (.flag_compile)
    -Compiles the fortran programs that matter (msd_rot_calc, visc_calc, flux_side)
    -Creates the file mol_names (molecule names listed one after another on new lines)
3) Trajectory Step (.flag_traj)
    -Checks if the LONG trajectory has been run 
        -LAMMPS looks for log.lammps
        -CP2K looks for cp2k.log
    -CP2K ONLY: Creates RESTART directory, copies restart files into that directory and renames them.
4) NVE Input Step (.flag_innve)
    -Checks if you have created an input file for your nve simulation.
        -LAMMPS looks for in.nve
        -CP2K looks for in.nve.cp2k
5) Run NVE Step (.flag_nve)
    -USER: Asks whether you want to run NVE trajectories.
    -Creates the file_names file (names of all file folders)
    -Creates FILES directory
    -Copies python scripts to top directory
        -read_input.py
        -set_msd_calcs.py
        -gen_sub_scripts.py
        -grab_press.py
        -[non-]unif-sample.py
    -Copies executables to top directory
        -msd_rot_calc
        -visc_calc
        -flux_side
    -Creates timestep file through [non-]unif-sample.py
    -Runs NVE trajectories in FILES subsystem
6) NVE Completion Step (.flag_nvecomplete)
    -Checks for whether the last NVE run has completed. 
7) Checkup Step (.flag_checkup)
    -LAMMPS: Checks to see if all subjobs have completed and reruns any missed jobs (if under 200)
    -CP2K: Wishes you best of luck and hopes that all have completed.
    -Moves all job array logs to a new directory logs.
8) Grab Energies Step (.flag_grabflucts)
    -Copies relevant grab_flucts.py to top directory
    -Copies grabfluctsub.sh to top directory
    -Submits grabfluctsub.sh
9) Initialize Segments Step (.flag_initarray)
    -Copies relevant python files to top directory
        -init_flucts.py
        -do_flucts.py
    -Makes SEG directory
    -Submits init_array.sh (generated by gen_sub_scripts.py in previous step)
10) Fluctation Calculation Step (.flag_valcalc)
    -Submits fluctuations calculation
11) Cleanup
    -Makes an Analysis Directory
    -Moves all output files to this directory.
    -Outputs a program complete message.

## Input File Generation

